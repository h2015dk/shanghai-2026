<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¸Šæµ·åŠ©æ‰‹ V17 - æ±Ÿå±±é§¿é¦¬</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --zhusha-red: #B22222; --mo-black: #2C2C2C; --paper-white: #F4F1E1; }
        
        body { 
            font-family: "PingFang TC", "STHeiti", serif; 
            background-color: var(--paper-white); 
            background-image: url('https://www.transparenttextures.com/patterns/rice-paper.png');
            color: var(--mo-black);
            -webkit-user-select: none;
            overflow-x: hidden;
        }

        /* éŸ¿æ‡‰å¼å®¹å™¨ */
        .responsive-container {
            max-width: 600px;
            margin: 0 auto;
            min-height: 100vh;
            background: rgba(244, 241, 225, 0.4);
            position: relative;
            z-index: 1;
        }

        /* æ ¸å¿ƒè¦–è¦ºï¼šè±å¯Œæ°´å¢¨å±±æ°´èƒŒæ™¯ (å…§åµŒ SVG) */
        .ink-landscape-bg {
            position: fixed;
            top: 10%;
            left: 50%;
            transform: translateX(-50%);
            width: 120%;
            max-width: 800px;
            opacity: 0.12; /* ç¢ºä¿èƒŒæ™¯è±å¯Œä½†ä¸æ“‹å­— */
            z-index: -1;
            pointer-events: none;
        }

        .app-card { 
            background: rgba(255, 255, 255, 0.9); 
            backdrop-filter: blur(8px);
            border: 1px solid #D4C5A2; 
            box-shadow: 4px 4px 15px rgba(0,0,0,0.05); 
            margin-bottom: 24px; 
            border-radius: 2px;
        }

        .nav-fixed { 
            position: fixed; bottom: 0; left: 50%; transform: translateX(-50%);
            width: 100%; max-width: 600px;
            background: rgba(244, 241, 225, 0.98); 
            backdrop-filter: blur(10px); 
            border-top: 2px solid var(--mo-black); 
            z-index: 100; 
            padding-bottom: env(safe-area-inset-bottom); 
        }

        .recomm-badge { 
            font-size: 10px; border: 1px solid var(--zhusha-red); color: var(--zhusha-red); 
            padding: 1px 4px; border-radius: 2px; margin-right: 4px; font-weight: bold;
        }

        .spot-link { 
            display: inline-flex; align-items: center; background: rgba(255, 255, 255, 0.8); 
            border: 0.5px solid #D4C5A2; padding: 2px 8px; border-radius: 2px; 
            margin: 2px; font-size: 11px; color: #444; 
        }

        textarea { 
            background: rgba(0, 0, 0, 0.03); border: 1px dashed #D4C5A2; 
            outline: none; width: 100%; padding: 10px; border-radius: 4px;
            font-size: 13px; margin-top: 10px; color: #555; -webkit-user-select: text; 
        }

        .currency-active { background: var(--mo-black); color: white; border-color: var(--mo-black); }
    </style>
</head>
<body class="pb-32">

    <div class="ink-landscape-bg">
        <svg viewBox="0 0 800 500" xmlns="http://www.w3.org/2000/svg">
            <path d="M-50 400 C150 150 300 350 450 180 S750 350 850 400" fill="none" stroke="black" stroke-width="1.5" opacity="0.4" />
            <path d="M100 420 C250 220 400 400 550 250 S750 380 900 420" fill="none" stroke="black" stroke-width="1" opacity="0.3" />
            <path d="M0 450 Q100 300 200 430 T400 350 T600 450" fill="none" stroke="black" stroke-width="2" />
            <g transform="translate(300, 240) scale(0.8)">
                <path d="M50 100 Q80 20 150 40 T220 80 Q250 150 200 180 S100 160 50 100" fill="black" opacity="0.9" /> <path d="M220 80 L280 40 M230 100 L290 70" stroke="black" stroke-width="3" /> <path d="M120 170 L80 250 M150 180 L130 260" stroke="black" stroke-width="6" stroke-linecap="round" /> <path d="M180 180 L210 260 M200 170 L240 250" stroke="black" stroke-width="6" stroke-linecap="round" /> </g>
            <path d="M600 100 Q610 90 620 100 M630 110 Q640 100 650 110" fill="none" stroke="black" stroke-width="1" />
            <rect x="700" y="50" width="30" height="50" fill="none" stroke="#B22222" stroke-width="2" opacity="0.6" />
            <text x="706" y="75" font-size="12" fill="#B22222" opacity="0.6" font-family="serif">é¦¬åˆ°</text>
            <text x="706" y="92" font-size="12" fill="#B22222" opacity="0.6" font-family="serif">æˆåŠŸ</text>
        </svg>
    </div>

    <div class="responsive-container">
        <header class="p-6 flex justify-between items-center border-b-2 border-black sticky top-0 bg-[#F4F1E1]/95 backdrop-blur-md z-50">
            <div class="flex items-center gap-4">
                <div class="w-12 h-12 bg-[#B22222] flex items-center justify-center text-white border-2 border-black shadow-[4px_4px_0px_rgba(0,0,0,1)]">
                    <i class="fas fa-horse text-xl"></i>
                </div>
                <div>
                    <h1 class="text-xl font-bold tracking-tighter text-gray-900 italic">ä¸Šæµ·è¡Œç¨‹ãƒ»æ±Ÿå±±é§¿é¦¬</h1>
                    <p class="text-[9px] opacity-60 uppercase tracking-widest font-black">Success 2026 Guide</p>
                </div>
            </div>
            <button onclick="openModal()" class="w-10 h-10 flex items-center justify-center border-2 border-black hover:bg-black hover:text-white transition-all">
                <i class="fas fa-plus"></i>
            </button>
        </header>

        <main class="p-5" id="main-container"></main>

        <section id="budget-section" class="p-5 hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-lg font-bold italic border-b-2 border-red-800">ã€ˆ ç›¤çºå¸³æœ¬ ã€‰</h2>
                <div class="text-[10px] font-bold text-gray-500 underline">åŒ¯ç‡ 1 : 4.5</div>
            </div>
            
            <div class="app-card p-6">
                <div class="grid grid-cols-2 gap-3 mb-4">
                    <input id="exp-name" type="text" placeholder="é …ç›®å…§å®¹" class="col-span-2 p-3 border-b border-gray-200 outline-none text-sm bg-transparent">
                    <div class="flex items-center gap-1 bg-gray-50 p-1 border col-span-2">
                        <input id="exp-amount" type="number" placeholder="é‡‘é¡" class="flex-grow p-2 bg-transparent outline-none text-sm">
                        <button onclick="setCurrency('RMB')" id="cur-RMB" class="px-3 py-1 text-[10px] border currency-active transition-all">RMB Â¥</button>
                        <button onclick="setCurrency('TWD')" id="cur-TWD" class="px-3 py-1 text-[10px] border transition-all">TWD $</button>
                    </div>
                    <select id="exp-cat" class="col-span-2 p-3 bg-gray-50 outline-none text-sm border font-bold">
                        <option value="ç”¨é¤">ç”¨é¤ ğŸœ</option><option value="äº¤é€š">äº¤é€š ğŸš‡</option>
                        <option value="ä½å®¿">ä½å®¿ ğŸ¨</option><option value="é–€ç¥¨">é–€ç¥¨ ğŸŸï¸</option>
                        <option value="è³¼ç‰©">è³¼ç‰© ğŸ›ï¸</option>
                    </select>
                    <button onclick="addExpense()" class="col-span-2 bg-black text-white py-4 font-bold hover:bg-red-900 transition-colors">
                        æ–°å¢è¨˜å¸³
                    </button>
                </div>
                <div id="expense-list" class="space-y-1 mt-6"></div>
                <div class="mt-8 pt-4 border-t-2 border-black flex flex-col items-end">
                    <div id="total-rmb" class="text-3xl font-black text-red-800 tracking-tighter">Â¥ 0.00</div>
                    <div id="total-twd" class="text-xs font-bold text-gray-400">â‰ˆ NT$ 0</div>
                </div>
            </div>
        </section>

        <nav class="nav-fixed flex justify-around p-4 shadow-lg">
            <button onclick="showTab('schedule')" id="btn-sch" class="flex flex-col items-center text-[#B22222]">
                <i class="fas fa-scroll text-xl mb-1"></i><span class="text-[10px] font-bold uppercase tracking-widest">è¡Œç¨‹å·è»¸</span>
            </button>
            <button onclick="showTab('budget')" id="btn-bud" class="flex flex-col items-center opacity-30">
                <i class="fas fa-wallet text-xl mb-1"></i><span class="text-[10px] font-bold uppercase tracking-widest">ç›¤çºè¨˜å¸³</span>
            </button>
        </nav>
    </div>

    <div id="modal" class="fixed inset-0 bg-black/60 hidden z-[200] flex items-center justify-center p-8 backdrop-blur-sm">
        <div class="bg-[#F4F1E1] border-2 border-black p-6 w-full max-w-sm relative shadow-[8px_8px_0px_rgba(0,0,0,1)]">
            <h3 class="font-bold text-center mb-6 border-b border-black pb-2 text-lg italic uppercase">Add Schedule</h3>
            <select id="new-day" class="w-full p-3 mb-4 border border-black outline-none bg-white font-bold"><option value="07/04">07/04</option><option value="07/05">07/05</option><option value="07/06">07/06</option><option value="07/07">07/07</option><option value="07/08">07/08</option></select>
            <input id="new-title" type="text" placeholder="åœ°é»åç¨±" class="w-full p-3 mb-4 border border-black outline-none bg-white">
            <select id="new-type" class="w-full p-3 mb-8 border border-black outline-none bg-white font-bold text-red-800"><option value="spot">æ™¯é» ğŸ“</option><option value="food">ç”¨é¤ ğŸœ</option><option value="transport">äº¤é€š ğŸš‡</option><option value="hotel">ä½å®¿ ğŸ¨</option><option value="exam">è€ƒè©¦ âœï¸</option></select>
            <div class="flex gap-4"><button onclick="closeModal()" class="flex-1 py-3 border border-black font-bold text-gray-400">å–æ¶ˆ</button><button onclick="addNewSchedule()" class="flex-1 py-3 bg-red-800 text-white font-bold">ç¢ºèª</button></div>
        </div>
    </div>

    <script>
        const RATE = 4.5;
        let selectedCurrency = 'RMB';
        const CATEGORY_ICONS = { food: 'ğŸœ', exam: 'âœï¸', spot: 'ğŸ“', transport: 'ğŸš‡', hotel: 'ğŸ¨' };
        
        const DB = {
            "æ©Ÿå ´è™¹æ©‹": { restaurants: ["å“ˆéˆè±¬è‚éºµ", "è€ç››æ˜Œæ¹¯åŒ…", "å¤§å£ºæ˜¥ç”Ÿç…"], spots: ["å¾å®¶åŒ¯æ›¸é™¢", "ä¸Šæµ·å‹•ç‰©åœ’", "ç¨‹åé«®ç¾è¡“é¤¨"], souvenirs: ["å¤§ç™½å…”å¥¶ç³–", "è´è¶é…¥", "ä¸Šæµ·è€é¦™è†"] },
            "æœ±å®¶è§’å¤é®": { restaurants: ["é˜¿å©†è§’ç²½", "èŒ‚è¨˜é†¬åœ’", "äº•äº­å¤§è‚‰"], spots: ["æ”¾ç”Ÿæ©‹", "èª²æ¤åœ’", "å¤§æ¸…éƒµå±€"], souvenirs: ["å¤é®ç´®è‚‰", "èŠ¡å¯¦ç³•", "æ‰‹å·¥ç´™æ‰‡"] },
            "å››è¡Œéœå®‰": { restaurants: ["ç‹å®¶æ²™é»å¿ƒ", "ä¸°è£•ç”Ÿç…", "å°æ¥Šç”Ÿç…"], spots: ["éœå®‰å…¬åœ’", "ä¸Šæµ·å±•è¦½ä¸­å¿ƒ", "å¼µåœ’"], souvenirs: ["æ²ˆå¤§æˆç³•é»", "ä¸‰é™½å—è²¨", "åŠŸå¾·æ—ç´ é£Ÿ"] },
            "å¤–ç˜è±«åœ’": { restaurants: ["èŸ¹åå¯³", "å—ç¿”é¥…é ­åº—", "æ»¬è¥¿è€å¼„å ‚"], spots: ["åå…­é‹ªç¢¼é ­", "ä¸Šæµ·ä¸­å¿ƒ52å±¤", "ä¹æµ¦è·¯æ©‹"], souvenirs: ["å¥³äººè¡—é›ªèŠ±è†", "çœŸçµ²çµ²å·¾", "æµ·æ´¾å‰ªç´™"] }
        };

        function getRecomm(title) {
            if(title.includes("æœ±å®¶è§’")) return DB["æœ±å®¶è§’å¤é®"];
            if(title.includes("å››è¡Œ") || title.includes("éœå®‰")) return DB["å››è¡Œéœå®‰"];
            if(title.includes("å¤–ç˜") || title.includes("è±«åœ’") || title.includes("æœµé›²")) return DB["å¤–ç˜è±«åœ’"];
            return DB["æ©Ÿå ´è™¹æ©‹"];
        }

        let schedules = JSON.parse(localStorage.getItem('sh_v17_sch')) || {
            "07/04": [{id:1, title:"è™¹æ©‹æ©Ÿå ´ / å‡±æ‚…å˜‰å¯“", type:"hotel"}],
            "07/05": [{id:2, title:"ä¸Šæµ·åœ‹å®¶è€ƒè©¦", type:"exam"}, {id:3, title:"æœ±å®¶è§’å¤é®", type:"spot"}],
            "07/06": [{id:4, title:"å››è¡Œå€‰åº« / éœå®‰å¯º", type:"spot"}],
            "07/07": [{id:5, title:"å¤–ç˜ / æœµé›²æ›¸é™¢", type:"spot"}],
            "07/08": [{id:6, title:"è¿”å°è¡Œç¨‹", type:"transport"}]
        };
        let expenses = JSON.parse(localStorage.getItem('sh_v17_exp')) || [];

        function renderSchedules() {
            const container = document.getElementById('main-container');
            container.innerHTML = '';
            Object.keys(schedules).forEach(day => {
                const section = document.createElement('section'); section.className = "mb-10";
                section.innerHTML = `<h2 class="text-xs font-black italic mb-5 text-gray-400">ã€” ${day} ã€•</h2><div id="list-${day.replace('/','-')}" class="sortable-list"></div>`;
                container.appendChild(section);
                schedules[day].forEach(item => {
                    const rec = getRecomm(item.title);
                    const spotLinks = rec.spots.map(s => `<button onclick="goAmap('${s}')" class="spot-link"><i class="fas fa-location-dot mr-1 opacity-50"></i>${s}</button>`).join('');
                    const card = document.createElement('div'); card.className = "app-card p-6";
                    card.dataset.id = item.id; card.dataset.type = item.type;
                    card.innerHTML = `<div class="flex items-start gap-3">
                        <div class="drag-handle mt-1 opacity-20"><i class="fas fa-grip-vertical"></i></div>
                        <div class="flex-grow">
                            <div class="flex justify-between items-start mb-2"><div class="font-bold text-lg text-gray-800">${CATEGORY_ICONS[item.type]} ${item.title}</div><button onclick="goAmap('${item.title}')" class="text-red-800 hover:scale-110 transition-all"><i class="fas fa-map-marked-alt text-xl"></i></button></div>
                            <div class="text-[11px] leading-6 space-y-1">
                                <div class="flex"><span class="recomm-badge">é¥Œ</span> <span class="text-gray-500 font-medium">${rec.restaurants.join('ãƒ»')}</span></div>
                                <div class="flex items-start mt-1"><span class="recomm-badge" style="border-color:#15803d; color:#15803d;">æ™¯</span> <div class="flex flex-wrap">${spotLinks}</div></div>
                                <div class="flex"><span class="recomm-badge" style="border-color:#555; color:#555;">ç‰©</span> <span class="text-gray-500 font-medium">${rec.souvenirs.join('ãƒ»')}</span></div>
                            </div>
                            <textarea onblur="saveAllData()" placeholder="é»æ“Šè¨˜éŒ„ç­†è¨˜...">${item.note || ''}</textarea>
                        </div></div>`;
                    section.querySelector('.sortable-list').appendChild(card);
                });
                new Sortable(section.querySelector('.sortable-list'), { group:'shared', animation:300, handle:'.drag-handle', onEnd: saveAllData });
            });
        }

        function saveAllData() {
            const newSch = {};
            document.querySelectorAll('.sortable-list').forEach(list => {
                const day = list.id.replace('list-','').replace('-','/');
                newSch[day] = [];
                list.querySelectorAll('.app-card').forEach(card => {
                    newSch[day].push({ id:card.dataset.id, title:card.querySelector('.font-bold').innerText.substring(3).trim(), type:card.dataset.type, note:card.querySelector('textarea').value });
                });
            });
            schedules = newSch; localStorage.setItem('sh_v17_sch', JSON.stringify(schedules));
        }

        function setCurrency(cur) { selectedCurrency = cur; document.getElementById('cur-RMB').className = (cur==='RMB'?'px-3 py-1 text-[10px] border currency-active':'px-3 py-1 text-[10px] border'); document.getElementById('cur-TWD').className = (cur==='TWD'?'px-3 py-1 text-[10px] border currency-active':'px-3 py-1 text-[10px] border'); }

        function renderExpenses() {
            const list = document.getElementById('expense-list'); let rmbTotal = 0; list.innerHTML = '';
            expenses.slice().reverse().forEach((ex, idx) => {
                const actualIdx = expenses.length - 1 - idx; let rmb = parseFloat(ex.amount); rmbTotal += rmb;
                list.innerHTML += `<div class="flex justify-between items-center py-4 border-b border-gray-100 bg-white/40">
                    <div class="flex items-center"><button onclick="deleteExpense(${actualIdx})" class="text-gray-300 px-2 mr-2 hover:text-red-700"><i class="fas fa-times-circle"></i></button>
                    <div class="text-xs font-bold text-gray-700"><div class="text-red-800 text-[10px] font-black">${ex.cat}</div>${ex.name}</div></div>
                    <div class="text-right font-mono"><div class="font-black text-gray-900">Â¥${rmb.toFixed(2)}</div><div class="text-[9px] text-gray-400">NT$${Math.round(rmb * RATE)}</div></div></div>`;
            });
            document.getElementById('total-rmb').innerText = `Â¥ ${rmbTotal.toFixed(2)}`;
            document.getElementById('total-twd').innerText = `â‰ˆ NT$ ${Math.round(rmbTotal * RATE).toLocaleString()}`;
            localStorage.setItem('sh_v17_exp', JSON.stringify(expenses));
        }

        function addExpense() {
            const n = document.getElementById('exp-name'), a = document.getElementById('exp-amount'), c = document.getElementById('exp-cat');
            if(n.value && a.value) {
                let rmb = parseFloat(a.value); if(selectedCurrency === 'TWD') rmb = rmb / RATE;
                expenses.push({ name: n.value, amount: rmb.toFixed(2), cat: c.value });
                n.value = ''; a.value = ''; renderExpenses();
            }
        }

        function deleteExpense(i) { if(confirm('è¦åˆªé™¤é€™ç­†ç´€éŒ„å—ï¼Ÿ')) { expenses.splice(i, 1); renderExpenses(); } }

        function showTab(t) {
            document.getElementById('main-container').classList.toggle('hidden', t==='budget');
            document.getElementById('budget-section').classList.toggle('hidden', t==='schedule');
            document.getElementById('btn-sch').style.opacity = t==='schedule' ? '1' : '0.4';
            document.getElementById('btn-bud').style.opacity = t==='budget' ? '1' : '0.4';
            if(t==='budget') renderExpenses();
        }

        function goAmap(k) { window.location.href = `amapuri://route/plan/?dname=${encodeURIComponent(k)}&dev=0&t=1`; }
        function openModal() { document.getElementById('modal').classList.remove('hidden'); }
        function closeModal() { document.getElementById('modal').classList.add('hidden'); }
        function addNewSchedule() {
            const d = document.getElementById('new-day').value, t = document.getElementById('new-title').value, ty = document.getElementById('new-type').value;
            if(t) { schedules[d].push({ id:Date.now(), title:t, type:ty, note:"" }); saveAllData(); renderSchedules(); closeModal(); }
        }
        window.onload = renderSchedules;
    </script>
</body>
</html>
